---
import { Image } from "astro:assets";
import Layout from "../layouts/Layout.astro";
import { getRecentFlights } from "../utils/db";
import { images } from "../utils/imageImports";

let flights = [];
try {
	flights = await getRecentFlights();
} catch (error) {
	console.error("Failed to fetch flights:", error);
}
---

<Layout>
	<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
		<div
			class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
		>
			{
				flights.map(
					(flight: {
						fr24_id: string;
						callsign: string;
						registration: string;
						operator: string;
						type: string;
						orig_iata: string;
						dest_iata: string;
						timestamp: string;
					}) => (
						<div class="bg-white dark:bg-gray-900 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden border border-gray-100 dark:border-gray-800 backdrop-blur-sm">
							<div class="relative">
								<Image
									src={images[flight.fr24_id] || images["unknown"]}
									alt={`Flight ${flight.callsign}`}
									class="w-full h-48 object-cover hover:scale-105 transition-transform duration-300"
									width={600}
									height={400}
								/>
								<div class="absolute top-3 right-3">
									<span class="bg-black/60 backdrop-blur-md text-white px-3 py-1 rounded-full text-sm font-medium">
										{flight.registration}
									</span>
								</div>
							</div>
							<div class="p-5">
								<h2 class="text-xl font-bold text-gray-900 dark:text-white">
									{flight.callsign}
								</h2>
								<p class="text-gray-600 dark:text-gray-400 mt-2 font-medium">
									{flight.operator} • {flight.type}
								</p>
								<div class="mt-4 flex items-center text-gray-700 dark:text-gray-300">
									<span class="font-semibold">{flight.orig_iata}</span>
									<span class="mx-2">→</span>
									<span class="font-semibold">{flight.dest_iata}</span>
								</div>
								<time
									datetime={flight.timestamp}
									class="text-sm text-gray-500 dark:text-gray-500 mt-3 block"
								>
									{new Date(flight.timestamp).toLocaleString()}
								</time>
							</div>
						</div>
					),
				)
			}
		</div>
		{
			flights.length === 0 && (
				<div class="text-center py-12">
					<p class="text-xl text-gray-600 dark:text-gray-400">
						No flights found
					</p>
				</div>
			)
		}
	</div>
</Layout>
